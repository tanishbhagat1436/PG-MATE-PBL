<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login / Sign Up</title>
  <link rel="stylesheet" href="auth.css">
</head>
<body>

  <div class="auth-box">
    <h2>Welcome to PG Mate</h2>

    <div class="tabs">
      <button onclick="switchForm('login')" id="login-tab" class="active">Log In</button>
      <button onclick="switchForm('signup')" id="signup-tab">Sign Up</button>
    </div>

    <!-- Login Form -->
    <div id="login" class="form active">
      <form>
        <select required>
          <option value="finder">PG Finder</option>
          <option value="owner">PG Owner</option>
        </select>
        <input type="email" placeholder="Email" required/>
        <input type="password" placeholder="Password" required/>
        <button type="submit" class="submit-btn">Log In</button>
      </form>
    </div>

    <!-- Signup Form -->
    <div id="signup" class="form">
      <form>
        <select required>
          <option value="finder">PG Finder</option>
          <option value="owner">PG Owner</option>
        </select>
        <input type="text" placeholder="Full Name" required/>
        <input type="email" placeholder="Email" required/>
        <input type="password" placeholder="Password" required/>
        <button type="submit" class="submit-btn">Sign Up</button>
      </form>
    </div>
  </div>

  <!-- Form Switcher -->
  <script>
    function switchForm(formId) {
      document.querySelectorAll('.form').forEach(form => form.classList.remove('active'));
      document.getElementById(formId).classList.add('active');

      document.getElementById('login-tab').classList.remove('active');
      document.getElementById('signup-tab').classList.remove('active');
      document.getElementById(formId + '-tab').classList.add('active');
    }
  </script>

  <!-- Firebase Auth Integration -->
  <script type="module">
    // Import Firebase SDKs
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { 
      getAuth, 
      createUserWithEmailAndPassword, 
      signInWithEmailAndPassword, 
      onAuthStateChanged 
    } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";

    // ðŸ”¹ Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyBRuD7eTDNphi4xiMAMVm5S6KUS7X4N5eg",
      authDomain: "pg-mate-efda5.firebaseapp.com",
      projectId: "pg-mate-efda5",
      storageBucket: "pg-mate-efda5.appspot.com",
      messagingSenderId: "764445496080",
      appId: "1:764445496080:web:24f07c03a4c2926d624b95",
      measurementId: "G-S692YPLXQP"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // ðŸ”¹ Handle Signup
    document.querySelector("#signup form").addEventListener("submit", (e) => {
      e.preventDefault();
      const role = e.target.querySelector("select").value;
      const email = e.target.querySelector('input[type="email"]').value;
      const password = e.target.querySelector('input[type="password"]').value;

      createUserWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
          localStorage.setItem("userRole", role);
          alert("Signup successful! Welcome " + userCredential.user.email);

          if (role === "finder") {
            window.location.href = "pg.html";   // âœ… Finder page
          } else {
            window.location.href = "owner.html"; // âœ… Owner page
          }
        })
        .catch((error) => {
          alert(error.message);
        });
    });

    // ðŸ”¹ Handle Login
    document.querySelector("#login form").addEventListener("submit", (e) => {
      e.preventDefault();
      const role = e.target.querySelector("select").value;
      const email = e.target.querySelector('input[type="email"]').value;
      const password = e.target.querySelector('input[type="password"]').value;

      signInWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
          localStorage.setItem("userRole", role);
          alert("Login successful! Welcome back " + userCredential.user.email);

          if (role === "finder") {
            window.location.href = "pg.html";   // âœ… Finder page
          } else {
            window.location.href = "owner.html"; // âœ… Owner page
          }
        })
        .catch((error) => {
          alert(error.message);
        });
    });

    // ðŸ”¹ Auto-check login state
    onAuthStateChanged(auth, (user) => {
      if (user) {
        console.log("Logged in:", user.email);
      } else {
        console.log("Not logged in");
      }
    });
  </script>

</body>
</html>
